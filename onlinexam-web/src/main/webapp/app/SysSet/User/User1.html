<!DOCTYPE html>
<html>
<head>
  <link href="../../../bower_components/bootstrap-switch/css/bootstrap-switch.min.css" rel="stylesheet" />
       <link href="../../../bower_components/bootstrap/dist/css/bootstrap.css" rel="stylesheet" />
    <link href="../../../bower_components/simple-line-icons/css/simple-line-icons.css" rel="stylesheet" />
    <link href="../../../bower_components/font-awesome/css/font-awesome.css" rel="stylesheet" />
    <link href="../../../bower_components/jqvmap/dist/jqvmap.css" rel="stylesheet" />
       <link href="../../../bower_components/morris.js/morris.css" rel="stylesheet" />

    <link href="../../../content/plugins/uniform/css/uniform.default.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="../../../content/css/task.css">
    <link rel="stylesheet" type="text/css" href="../../../content/css/components-rounded.css">
    <link rel="stylesheet" type="text/css" href="../../../content/css/plugins.css">
    <link rel="stylesheet" type="text/css" href="../../../content/css/default.css">
    <link rel="stylesheet" type="text/css" href="../../../content/css/custom.css">
    <link rel="stylesheet" type="text/css" href="../../../content/css/layout.css">
    <link rel="stylesheet" type="text/css" href="../../../content/css/default.css">
    <script src="../../../bower_components/jquery/dist/jquery.min.js"></script>
    <script src="../../../bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    <title></title>
</head>
<body>
  <div class="page-content">
        <div class="container">
            <!-- BEGIN PAGE BREADCRUMB -->
            <ul class="page-breadcrumb breadcrumb">
                <li>
                    <a href="#">主页</a><i class="fa fa-circle"></i>
                </li>
                <li class="active">系统设置<i class="fa fa-circle"></i>
                </li>
                <li class="active">用户管理
                </li>
            </ul>
            <form class="form-inline" role="form">
                <div class="form-group">
                    <label class="control-label">公司名称</label>
                    <select class="form-control input-small select2" data-placeholder="请选择公司名称" id="txt_Depart" onchange="">
                    </select>
                </div>
                <div class="form-group">
                    <label class="control-label">部门</label>
                    <select class="form-control input-small select2" data-placeholder="请选择部门" id="txt_Depart" onchange="">
                    </select>
                </div>
                <div class="form-group" style="margin-left: 15px;">
                    <label for="txt_UserName">用户名</label>
                    <input class="form-control form-control-inline input-small" size="16" onchange="" id="txt_UserName" type="text" value="">
                </div>
                <div class="form-group" style="margin-left: 15px;">
                    <label for="txt_RealName">手机号</label>
                    <input class="form-control form-control-inline input-small" size="16" onchange="" id="txt_RealName" type="text" value="">
                </div>

                <div class="form-group" style="margin-left: 15px;">
                    <input id="btn_Search" type="button" value="搜索" class="btn btn-success" />
                </div>
            </form>
            <div class="row margin-top-15">
                <div class="col-md-12">
                    <!-- BEGIN EXAMPLE TABLE PORTLET-->
                    <div class="portlet light">
                        <div class="portlet-title">
                            <div class="caption">
                                <i class="fa fa-cogs font-green-sharp"></i>
                                <span class="caption-subject font-green-sharp bold uppercase">用户管理</span>
                            </div>
                            <div class="tools">
                                <%-- <a href="javascript:;" class="collapse"></a>--%>
                                <a href="javascript:;" class="reload" id="reload"></a>
                            </div>
                        </div>
                        <div class="portlet-body">
                            <div class="table-toolbar">
                                <div class="row">
                                    <div class="col-md-6">
                                        <%--<a class="btn green" data-toggle="modal" id="btn_Add" href="#responsive">新增用户 </a>--%>
                                        <a class="btn purple" data-toggle="modal" id="btn_Delete" href="#responsive">批量删除 </a>
                                        <a class="btn blue" data-toggle="modal" id="btn_ResetPwd" href="#responsive">重置密码 </a>
                                    </div>
                                    <div class="col-md-6">
                                        <%--<div class="btn-group pull-right">
                                            <button class="btn dropdown-toggle" data-toggle="dropdown">
                                                Tools <i class="fa fa-angle-down"></i>
                                            </button>
                                            <ul class="dropdown-menu pull-right">
                                                <li>
                                                   <a href="javascript:;">导出Excel </a> 
                                                </li>
                                            </ul>
                                        </div>--%>
                                    </div>
                                </div>
                            </div>
                            <table class="table table-striped table-bordered table-hover" id="sample_1">
                                <thead>
                                    <tr>
                                        <th class="table-checkbox">
                                            <input type="checkbox" id="chk_all" class="group-checkable" data-set="#sample_1 .checkboxes" />
                                        </th>
                                        <th>登录名</th>
                                        <th>工号</th>
                                        <th>职务</th>
                                        <th>手机</th>
                                        <th>邮箱</th>
                                        <th>公司名称</th>
                                        <th></th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="search_result">
                                </tbody>
                            </table>
                            <div class="row margin-top-0">
                                <div class="col-md-12" style="text-align: right;">
                                    <ul class="pagination" id="pager_container">
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- END EXAMPLE TABLE PORTLET-->
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="basic" tabindex="-1" role="basic" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                    <h4 class="modal-title">编辑用户</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-12">
                            <!-- BEGIN FORM-->
                            <form action="javascript:;" class="horizontal-form" id="user_form">
                                <div class="form-body">
                                    <div class="alert alert-danger display-hide">
                                        <button class="close" data-close="alert"></button>
                                        <label id="lbl_Msg"></label>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="control-label">用户名</label>
                                                <input type="text" id="txtUMID" name="UMID" class="form-control" placeholder="用户名">
                                                <input id="hide_Id" type="hidden" />
                                            </div>
                                        </div>
                                        <!--/span-->
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="control-label">真实姓名</label>
                                                <input type="text" id="txtRealName" name="RealName" class="form-control" placeholder="真实姓名">
                                            </div>
                                        </div>
                                        <!--/span-->
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="control-label">性别</label>
                                                <select class="form-control" id="slt_Sex" name="Sex">
                                                    <option value="0"></option>
                                                    <option value="1">男</option>
                                                    <option value="2">女</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="control-label">部门</label>
                                                <select class="select2_category form-control" id="slt_Depart" name="Depart" data-placeholder="请选择部门" tabindex="1">
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <!--/row-->
                                    <div class="row">

                                        <!--/span-->
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="control-label">团队</label>
                                                <select class="select2_category form-control" id="slt_Team" name="Team" data-placeholder="请选择部门" tabindex="1">
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <span class="help-block">测试阶段默认密码为：123456</span>
                                            </div>
                                        </div>
                                        <!--/span-->
                                    </div>
                                    <div class="row">
                                        <div class="col-md-offset-3 col-md-9">
                                            <button type="submit" id="btn_Save" class="btn green">提交</button>
                                            <button type="reset" id="btn_Clear" class="btn btn-default">清空</button>
                                        </div>
                                    </div>
                                </div>
                            </form>
                            <!-- END FORM-->
                        </div>
                    </div>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
    <!-- responsive -->
    <form action="../Ajax/ChartAjax.ashx?action=DownloadVersion" id="form_300" method="post" target="_blank">
        <input id="hide_date" name="sltDate" type="hidden" />
        <input id="hide_apptype" name="appType" type="hidden" />
        <input id="hide_store" name="AppStore" type="hidden" />
    </form>
</body>
    <script src="../Content/assets/global/plugins/bootbox/bootbox.min.js" type="text/javascript"></script>
    <script type="text/javascript" src="../Content/Scripts/Common.js"></script>
    <script type="text/javascript" src="../Content/assets/global/plugins/jquery-validation/js/jquery.validate.min.js"></script>
    <script type="text/javascript" src="../Content/Scripts/Page/user-validation.js"></script>
    <script type="text/javascript">
        var form3 = $('#user_form');
        var error3 = $('.alert-danger', form3);
        jQuery(document).ready(function () {
            FormValidation.init();

            $("#btn_ResetPwd").click(function () {
                ResetPwd();
            });

            $("#reload").click(function () {
                SearchQuery();
            });

            //bindDept();
            SearchQuery();

            $("#chk_all").click(function () {
                if ($(this).prop("checked")) { // 全选
                    $("#search_result input[class='checkboxes']").each(function () {
                        $(this).prop("checked", true);
                    });
                }
                else { // 取消全选
                    $("#search_result input[class='checkboxes']").each(function () {
                        $(this).prop("checked", false);
                    });
                }
            });

            $("#btn_Add").click(function () {
                $("#txtUMID").removeAttr("disabled");
                $('#basic').modal('show');
                $("#hide_Id").val("");
                $("#slt_Sex").val("");
                $("#txtUMID").val("");
                $("#txtRealName").val("");
                $("#slt_Depart").val("");
                $("#slt_Team").val("");
            });
            $("#btn_Search").click(function () {
                SearchQuery();
            });
            $("#btn_Delete").click(function () {
                delete_datas();
            });
            bindTeam();
        });

        function bindTeam() {
            jQuery.ajax({
                type: 'post',
                url: "../Ajax/SecurityAjax.ashx?action=GetTeamList",
                data: "",
                cache: false,
                dataType: "json",
                success: function (data) {
                    $("#slt_Team").empty();
                    if (data.status == 231) {
                        var list = data.result_data;
                        for (var i = 0; i < list.length; i++) {
                            var temp = list[i];
                            $("#slt_Team").append("<option value='" + temp.TEAMID + "'>" + temp.TEAMNAME + "</option>");
                        }
                        loadCharts();
                    } else if (result.status == 133) {
                        window.location.href = "../Login.aspx";
                    }
                }
            });
        }

        function bindDept() {
            jQuery.ajax({
                type: 'post',
                url: "../Ajax/SecurityAjax.ashx?action=GetDeptList",
                data: "",
                cache: false,
                dataType: "json",
                success: function (data) {
                    $("#txt_Depart").empty();
                    $("#slt_Depart").empty();
                    $("#txt_Depart").append("<option value=''></option>");
                    if (data.status == 231) {
                        var list = data.result_data;
                        for (var i = 0; i < list.length; i++) {
                            var temp = list[i];
                            //if (i == list.length - 2) {
                            //    $("#txt_yysc").append("<option selected=\"selected\" value='" + tvalue + "'>" + temp[0] + "</option>");
                            //} else {
                            $("#txt_Depart").append("<option value='" + temp.DepId + "'>" + temp.DepName + "</option>");
                            $("#slt_Depart").append("<option value='" + temp.DepId + "'>" + temp.DepName + "</option>");
                            //}
                        }
                        loadCharts();
                    } else if (result.status == 133) {
                        window.location.href = "../Login.aspx";
                    }
                }
            });
        }

        function edit_data(delete_id, name) {
            $('#basic').modal('show');
            $("#txtUMID").attr("disabled", "disabled");
            var pValue = {
                uid: delete_id
            };
            $("#slt_Sex").val("");
            $("#hide_Id").val("");
            $("#txtUMID").val("");
            $("#txtRealName").val("");
            $("#slt_Depart").val("");
            //$("#txtPassword").val("");
            $("#slt_Team").val("");
            jQuery.ajax({
                type: 'post',
                url: "../Ajax/SecurityAjax.ashx?action=GetUser",
                data: pValue,
                cache: false,
                dataType: "json",
                success: function (data) {
                    if (data.status == 231) {
                        var model = data.result_data;
                        $("#slt_Sex").val(model.Sex);
                        $("#hide_Id").val(model.UserId);
                        $("#txtUMID").val(model.UserName);
                        $("#txtRealName").val(model.RealName);
                        $("#slt_Depart").val(model.Depart);
                        //$("#txtPassword").val("******");
                        $("#slt_Team").val(model.Team);
                    } else if (result.status == 133) {
                        window.location.href = "../Login.aspx";
                    } else {
                        bootbox.alert(result.result_data);
                    }
                }
            });
        }

        function SaveUser() {
            var pValue = {
                Sex: $("#slt_Sex").val(),
                UserId: $("#hide_Id").val(),
                EditName: $("#txtUMID").val(),
                RealName: $("#txtRealName").val(),
                Dept: $("#slt_Depart").val(),
                //Password: $("#txtPassword").val(),
                Team: $("#slt_Team").val()
            };
            jQuery.ajax({
                type: 'post',
                url: "../Ajax/SecurityAjax.ashx?action=SaveUser",
                data: pValue,
                cache: false,
                dataType: "json",
                success: function (result) {
                    if (result.status == 230) {
                        $('#basic').modal('hide')
                        SearchQuery();
                    } else if (result.status == 133) {
                        window.location.href = "../Login.aspx";
                    } else {
                        $("#lbl_Msg").text(result.result_data);
                        error3.show();
                    }
                    setTimeout(function () {
                        $(".alert").alert('close');
                    }, 2600);
                }
            });
        }

        function loadCharts() {
            $("#hide_date").val($("#txt_StartDate").val());
            $("#hide_apptype").val($("#slt_AppType").val());
            $("#hide_store").val($("#txt_yysc").val());
            SearchQuery();
        }

        var _pSize = 7;
        function SetPagerNo(cPage) {
            SearchQuery(cPage, _pSize);
        }
        function SearchQuery(cPage, pSize) {
            if (!arguments[0]) cPage = _cPage;//当前页索引
            if (!arguments[1]) pSize = _pSize;//页显示记录数
            var pValue = {
                startindex: (cPage - 1) * pSize + 1,
                endindex: cPage * pSize,
                EditName: $("#txt_UserName").val(),
                RealName: $("#txt_RealName").val(),
                Dept: $("#txt_Depart").val()
            };
            jQuery.ajax({
                type: 'post',
                url: "../Ajax/SecurityAjax.ashx?action=GetUserPage",
                data: pValue,
                cache: false,
                dataType: "json",
                beforeSend: function () {
                    $("#search_result").html("<tr><td colspan='20' height='200' align='center'><img src='/Images/loadgif.gif' /></td></tr>");
                },
                success: function (result) {
                    if (result.status == null || result.status == "undefined") {
                        BindQueryList(result.content);
                        SetPager(cPage, result.totalElements, "#pager_container", pSize);
                    } else if (result.status == 133) {
                        window.location.href = "../Login.aspx";
                    } else {
                        SetPager(cPage, 0, "#pager_container", pSize);
                        $("#search_result").html("<tr><td colspan=\"20\" style=\"text-align:center;\">" + result.result_data + "</td></tr>");
                    }
                }
            });
        }

        function BindQueryList(result_data) {
            var oHtml = "";
            for (var i = 0; i < result_data.length; i++) {
                var data = result_data[i];
                oHtml += "<tr>";
                oHtml += "<td><input type=\"checkbox\" class=\"checkboxes\" value=\"" + data.id + "\" name=\"" + data.uid + "\" /></td>";
                oHtml += "<td>" + data.uid + "</td>";
                oHtml += "<td>" + data.serialNo + "</td>";
                oHtml += "<td>" + data.title + "</td>";
                oHtml += "<td>" + data.phone + "</td>";
                oHtml += "<td>" + data.email + "</td>";
                oHtml += "<td>" + data.companyName + "</td>";
                //oHtml += "<td>" + data.LogTime + "</td>";
                oHtml += "<td><a href=\"javascript:void(0);\"  class=\"Edit\" onclick=\"edit_data('" + data.id + "','" + data.uid + "');\">编辑</a></td>";
                oHtml += "<td><a href=\"javascript:void(0);\"  class=\"Delete\" onclick=\"delete_data('" + data.id + "','" + data.uid + "');\">删除</a></td>";
                oHtml += "</tr>";
            }
            jQuery("#search_result").html(oHtml);
        }

        function delete_data(delete_id, name) {
            var msg = "确定删除 " + name + " ?";
            bootbox.confirm(msg, function (result) {
                if (result) {
                    var pValue = {
                        uid: name
                    };
                    jQuery.ajax({
                        type: 'post',
                        url: "../Ajax/SecurityAjax.ashx?action=DeleteUser",
                        data: pValue,
                        cache: false,
                        dataType: "json",
                        success: function (result) {
                            if (result.status == 133) {
                                window.location.href = "../Login.aspx";
                            } else {
                                bootbox.alert(result.result_data);
                            }
                        }
                    });
                }
                else {
                }
            });
        }

        function delete_datas() {
            var idlist = "";
            var namelist = "";
            $("#search_result input[class='checkboxes']").each(function () {
                if ($(this).prop("checked")) {
                    if (idlist == "") {
                        idlist += $(this).attr("value");
                        namelist += $(this).attr("name");
                    } else {
                        idlist += "," + $(this).attr("value");
                        namelist += "," + $(this).attr("name");
                    }
                }
            });
            if (idlist == "") {
                bootbox.alert("请选择要删除的条目");
                return;
            }
            var msg = "确定删除 " + namelist + " ?";
            bootbox.confirm(msg, function (result) {
                if (result) {
                    var pValue = {
                        UserId: idlist
                    };
                    jQuery.ajax({
                        type: 'post',
                        url: "../Ajax/SecurityAjax.ashx?action=DeleteUsers",
                        data: pValue,
                        cache: false,
                        dataType: "json",
                        success: function (result) {
                            if (result.status == 230) {
                                SearchQuery();
                            } else if (result.status == 133) {
                                window.location.href = "../Login.aspx";
                            } else {
                                bootbox.alert(result.result_data);
                            }
                        }
                    });
                }
                else {
                }
            });
        }

        function ResetPwd() {
            var idlist = "";
            var namelist = "";
            $("#search_result input[class='checkboxes']").each(function () {
                if ($(this).prop("checked")) {
                    if (idlist == "") {
                        idlist += $(this).attr("value");
                        namelist += $(this).attr("name");
                    } else {
                        idlist += "," + $(this).attr("value");
                        namelist += "," + $(this).attr("name");
                    }
                }
            });
            if (idlist == "") {
                bootbox.alert("请选择要重置的用户");
                return;
            }
            var msg = "确定重置的用户：" + namelist + " 的密码？密码将被重置为默认密码：123456";
            bootbox.confirm(msg, function (result) {
                if (result) {
                    var pValue = {
                        UserId: idlist
                    };
                    jQuery.ajax({
                        type: 'post',
                        url: "../Ajax/SecurityAjax.ashx?action=ResetPwd",
                        data: pValue,
                        cache: false,
                        dataType: "json",
                        success: function (result) {
                            if (result.status == 230) {
                                bootbox.alert(result.result_data);
                            } else if (result.status == 133) {
                                window.location.href = "../Login.aspx";
                            } else {
                                bootbox.alert(result.result_data);
                            }
                        }
                    });
                }
                else {
                }
            });
        }
    </script>
</html>
    <!-- BEGIN PAGE CONTENT -->
  
    <!-- END PAGE CONTENT -->

